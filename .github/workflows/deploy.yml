name: Deploy to Production

on:
    push:
        branches: [main]
    workflow_dispatch:

jobs:
    deploy:
        name: Deploy Services
        runs-on: ubuntu-latest
        environment: production
        steps:
            - name: Checkout code
              uses: actions/checkout@v3

            - name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v2

            - name: Build Docker Compose Services
              run: docker compose build

            - name: Deploy Services
              run: |
                  echo "ðŸš€ Deploying services..."
                  docker compose up -d

            - name: Health Check
              run: |
                  echo "â³ Waiting for services to start..."
                  sleep 10
                  echo "âœ… Services deployed successfully!"

            - name: Deployment Summary
              run: |
                  echo "## ðŸš€ Deployment Summary" >> $GITHUB_STEP_SUMMARY
                  echo "âœ… User Service: Deployed" >> $GITHUB_STEP_SUMMARY
                  echo "âœ… Product Service: Deployed" >> $GITHUB_STEP_SUMMARY
                  echo "âœ… Nginx Gateway: Deployed" >> $GITHUB_STEP_SUMMARY
